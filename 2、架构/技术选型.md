# 技术选型

> 📅 最后更新：2026-01-11
> 📋 基于项目源码自动分析生成

---

## 🖥️ 前端技术栈

### Cunkebao (主前端应用)

| 技术 | 版本 | 说明 |
|------|------|------|
| **React** | 18.2.0 | 核心框架 |
| **TypeScript** | 5.4.5 | 类型系统 |
| **Vite** | 7.0.5 | 构建工具 |
| **React Router** | 6.20.0 | 路由管理 |
| **Zustand** | 5.0.6 | 状态管理 |
| **Ant Design** | 5.13.1 | PC端UI组件 |
| **Ant Design Mobile** | 5.39.1 | 移动端UI组件 |
| **Axios** | 1.6.7 | HTTP请求 |
| **ECharts** | 5.6.0 | 图表库 |
| **Day.js** | 1.11.13 | 日期处理 |
| **react-window** | 1.8.11 | 虚拟滚动 |
| **SASS** | 1.75.0 | CSS预处理器 |
| **PostCSS pxtorem** | 6.0.0 | 移动端适配 |

### Touchkebao (触控版前端)

| 技术 | 版本 | 说明 |
|------|------|------|
| **React** | 18.x | 核心框架 |
| **TypeScript** | 5.x | 类型系统 |
| **Vite** | 7.x | 构建工具 |
| **Vant UI** | - | 移动端UI组件 |
| **Tailwind CSS** | - | 原子化CSS |

### SuperAdmin (管理后台)

| 技术 | 版本 | 说明 |
|------|------|------|
| **Next.js** | 14.x | React全栈框架 |
| **TypeScript** | 5.x | 类型系统 |
| **Shadcn UI** | - | 现代UI组件 |
| **Tailwind CSS** | - | 原子化CSS |

### Store_vue (门店应用)

| 技术 | 版本 | 说明 |
|------|------|------|
| **Vue 3** | - | 核心框架 |
| **UniApp** | - | 跨端框架 |
| **uView** | - | UI组件库 |

### aiApp / ckApp (移动应用)

| 技术 | 版本 | 说明 |
|------|------|------|
| **Vue 3** | - | 核心框架 |
| **UniApp** | - | 跨端框架 |
| **Vite** | - | 构建工具 |

---

## 🔧 后端技术栈

### Server (主后端服务)

| 技术 | 版本 | 说明 |
|------|------|------|
| **PHP** | ≥7.4 | 开发语言 |
| **ThinkPHP** | 5.1.41 | 核心框架 |
| **Workerman** | 3.5 | 长连接服务 |
| **GatewayWorker** | 3.0 | WebSocket服务 |
| **Guzzle** | 6.5 | HTTP客户端 |
| **PHPSpreadsheet** | 1.29 | Excel处理 |
| **EasyWeChat** | 4.6 | 微信SDK |
| **endroid/qr-code** | 3.9 | 二维码生成 |
| **Monolog** | 1.27 | 日志管理 |
| **Hashids** | 2.0 | ID混淆 |

### Moncter (监控服务)

| 技术 | 版本 | 说明 |
|------|------|------|
| **PHP** | ≥8.1 | 开发语言 |
| **Webman** | 2.1 | 高性能框架 |
| **MongoDB Laravel** | 4.0 | MongoDB ORM |
| **Predis** | 2.0 | Redis客户端 |
| **php-amqplib** | 3.7 | RabbitMQ客户端 |
| **Monolog** | 2.0 | 日志管理 |
| **Cron Expression** | 3.6 | 定时任务 |

---

## 🗄️ 数据库

| 数据库 | 用途 | 说明 |
|--------|------|------|
| **MongoDB** | 主数据库 | 存储业务数据、消息记录 |
| **MySQL** | 辅助数据库 | 存储关系型数据、用户信息 |
| **Redis** | 缓存 | 会话管理、数据缓存、队列 |

### 数据库连接信息

```
# 卡若私域数据库 (MySQL)
地址: 10.88.182.62:3306
账号: root
密码: Vtka(agu)-1

# 腾讯云数据库 (MySQL)
地址: 56b4c23f6853c.gz.cdb.myqcloud.com:14413
账号: cdb_outerroot
密码: Zhiqun1984
```

---

## 🔌 中间件

| 中间件 | 用途 |
|--------|------|
| **Redis** | 缓存、会话、队列 |
| **RabbitMQ** | 消息队列 |
| **Nginx** | 反向代理、静态资源 |

---

## ☁️ 云服务

### 腾讯云

| 服务 | 用途 |
|------|------|
| **COS** | 对象存储 |
| **CDB** | 云数据库 |
| **CDN** | 内容分发 |

**API配置**：
```
APPID: 1251077262
SecretId: REMOVED_FOR_SECURITY
```

### 阿里云

| 服务 | 用途 |
|------|------|
| **OSS** | 对象存储 |
| **SMS** | 短信服务 |

**API配置**：
```
AccessKey ID: REMOVED_FOR_SECURITY
AccessKey Secret: REMOVED_FOR_SECURITY
```

---

## 🛠️ 开发工具

| 工具 | 用途 |
|------|------|
| **pnpm** | 前端包管理 |
| **Composer** | PHP包管理 |
| **ESLint** | JS/TS代码检查 |
| **Prettier** | 代码格式化 |
| **Git** | 版本控制 |

---

## 📱 构建目标

| 平台 | 技术方案 |
|------|----------|
| **Web** | React SPA / Next.js SSR |
| **H5** | React + Vant UI |
| **iOS/Android** | UniApp 打包 |
| **微信小程序** | UniApp 编译 |

---

## 🔗 核心通信协议

### WebSocket 通信

| 配置项 | 值 | 说明 |
|--------|------|------|
| **服务地址** | wss://s2.siyuguanli.com:9993 | 设备代理服务器 |
| **协议** | Sec-WebSocket-Protocol: soap | 子协议 |
| **心跳间隔** | 30秒 | 保活心跳 |
| **超时时间** | 86400秒 | 连接超时 |

### 消息格式

```json
{
  "cmdType": "CmdSignIn",      // 命令类型
  "accessToken": "xxx",        // 认证令牌
  "accountId": "xxx",          // 账号ID
  "client": "kefu-client",     // 客户端标识
  "seq": 1                     // 序列号
}
```

### 支持的命令类型

| 命令 | 说明 |
|------|------|
| `CmdSignIn` | 登录认证 |
| `CmdHeartbeat` | 心跳保活 |
| `CmdFetchMoment` | 获取朋友圈 |
| `CmdSendMsg` | 发送消息 |
| `CmdCreateChatroom` | 创建群聊 |
| `CmdAddFriend` | 添加好友 |
| `CmdFetchFriends` | 获取好友列表 |

---

## ⚙️ 任务调度系统

### 定时任务列表

| 任务 | 命令 | 周期 | 说明 |
|------|------|------|------|
| 自动点赞 | `workbench:autoLike` | 5分钟 | 自动点赞好友朋友圈 |
| 朋友圈同步 | `workbench:moments` | 10分钟 | 同步发布朋友圈 |
| 群消息推送 | `workbench:groupPush` | 1分钟 | 群发消息任务 |
| 自动建群 | `workbench:groupCreate` | 1分钟 | 自动创建群聊 |
| 入群欢迎语 | `workbench:groupWelcome` | 1分钟 | 新成员欢迎 |
| 流量分发 | `workbench:trafficDistribute` | 5分钟 | 流量自动分配 |
| 健康分计算 | `wechat:calculate-score` | 每天凌晨 | 计算账号健康分 |
| 数据同步 | `sync:wechatData` | 10分钟 | 同步微信数据 |

### Workerman 进程分配

| 进程ID | 任务 | 间隔 |
|--------|------|------|
| Worker 1 | 自动问候任务 | 60秒 |
| Worker 2 | 获客新任务处理 | 1秒 |
| Worker 3 | 获客任务状态更新 | 60秒 |
| Worker 4 | 获客任务新用户处理 | 60秒 |

---

## 🔒 安全配置

### 认证方式

| 方式 | 应用场景 | 说明 |
|------|----------|------|
| **JWT Token** | API 接口 | 无状态认证 |
| **Session** | Web 管理后台 | 有状态认证 |
| **API Key** | 第三方调用 | 简单认证 |

### 数据加密

| 场景 | 加密方式 |
|------|----------|
| 密码存储 | bcrypt |
| 敏感数据传输 | HTTPS/TLS |
| API 签名 | HMAC-SHA256 |

---

## 📊 监控与日志

### 日志配置

| 日志类型 | 存储位置 | 保留时间 |
|----------|----------|----------|
| 应用日志 | `runtime/log/` | 30天 |
| 错误日志 | `runtime/log/error/` | 90天 |
| 访问日志 | Nginx | 7天 |
| 任务日志 | MongoDB | 30天 |

### 监控指标

| 指标 | 说明 |
|------|------|
| QPS | 每秒请求数 |
| 响应时间 | P50/P95/P99 |
| 错误率 | 5xx 错误占比 |
| 队列长度 | 待处理任务数 |
| 连接数 | WebSocket 活跃连接 |

---

## ⚠️ 注意事项

1. **前端**：优先使用 TypeScript，避免 any 类型
2. **后端**：PHP 7.4+ 环境，Moncter 服务需要 PHP 8.1+
3. **数据库**：默认使用 MongoDB，关系型数据使用 MySQL
4. **缓存**：所有缓存操作通过 Redis 进行
5. **API密钥**：生产环境密钥需要单独配置，不要提交到代码库
6. **WebSocket**：需要实现心跳检测和自动重连机制
7. **任务调度**：注意任务幂等性，避免重复执行
8. **风控**：严格控制消息发送频率，避免账号被封

---

## 📚 相关文档

| 文档 | 路径 | 说明 |
|------|------|------|
| 核心业务链路 | `开发文档/2、架构/核心业务链路.md` | 业务流程详解 |
| 自动化工作流 | `开发文档/2、架构/自动化工作流.md` | 任务调度详解 |
| 解决方案对比 | `开发文档/2、架构/解决方案对比与优化建议.md` | 优化建议 |
| 系统架构 | `开发文档/2、架构/系统架构.md` | 整体架构 |